{% comment %}
  Category Card Snippet
  Usage: {% render 'collection-card', category: category_data %}

  category object can be:
  - A collection object (will auto-extract title, image, url)
  - A custom object with:
    - image: category image
    - title: category name
    - link: category URL
    - text_position: text positioning
    - aspect_ratio: aspect ratio for the card
{% endcomment %}

{% comment %} Auto-extract data if a collection object is passed {% endcomment %}
{% if category.handle and category.products_count != blank %}
  {% comment %} This is a collection object, extract the data {% endcomment %}
  {% assign category_title = category.title %}
  {% assign category_image = category.metafields.custom.card_image.value | default: category.image %}
  {% assign category_link = category.url %}
  {% assign aspect_ratio = aspect_ratio %}
{% else %}
  {% comment %} This is a custom category object, use the passed values {% endcomment %}
  {% assign category_title = category.title %}
  {% assign category_image = category.image %}
  {% assign category_link = category.link %}
  {% assign aspect_ratio = category.aspect_ratio %}
{% endif %}

{% assign text_position_classes = 'absolute text-white z-10' %}

{% case category.text_position %}
  {% when 'bottom-left' %}
    {% assign text_position_classes = text_position_classes | append: ' bottom-4 left-4' %}
  {% when 'bottom-center' %}
    {% assign text_position_classes = text_position_classes
      | append: ' bottom-4 left-1/2 transform -translate-x-1/2 text-center'
    %}
  {% when 'bottom-right' %}
    {% assign text_position_classes = text_position_classes | append: ' bottom-4 right-4 text-right' %}
  {% when 'center' %}
    {% assign text_position_classes = text_position_classes
      | append: ' top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center'
    %}
  {% else %}
    {% assign text_position_classes = text_position_classes | append: ' bottom-4 left-4' %}
{% endcase %}

{% comment %} Set aspect ratio classes {% endcomment %}
{% assign aspect_ratio_class = 'portrait' %}
{% case aspect_ratio %}
  {% when 'square' %}
    {% assign aspect_ratio_class = 'aspect-square' %}
  {% when 'portrait' %}
    {% assign aspect_ratio_class = 'aspect-[3/4]' %}
  {% when 'landscape' %}
    {% assign aspect_ratio_class = 'aspect-[4/3]' %}
  {% when 'wide' %}
    {% assign aspect_ratio_class = 'aspect-[16/9]' %}
  {% when 'ultra-wide' %}
    {% assign aspect_ratio_class = 'aspect-[21/9]' %}
  {% when 'tall' %}
    {% assign aspect_ratio_class = 'aspect-[2/3]' %}
  {% else %}
    {% assign aspect_ratio_class = 'aspect-square' %}
{% endcase %}

{% if category_link %}
  <a
    href="{{ category_link }}"
    class="collection-card block relative {{ aspect_ratio_class }} overflow-hidden group w-[110%] md:min-w-[220px]"
  >
{% else %}
  <div class="collection-card relative overflow-hidden {{ aspect_ratio_class }} w-[110%] md:min-w-[220px]">
{% endif %}

{% if category_image %}
  {{
    category_image
    | image_url: width: 400
    | image_tag:
      class: 'w-full h-full object-cover transition-transform duration-300',
      alt: category_title,
      loading: 'lazy'
  }}
{% else %}
  <div class="w-full h-full bg-gray-200 flex items-center justify-center">
    <span class="text-gray-400 text-sm">No image</span>
  </div>
{% endif %}

<!-- Gradient overlay for better text readability -->
<div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent to-60%"></div>

{% if category_title %}
  <div class="{{ text_position_classes }}">
    <h3>
      {{ category_title }}
    </h3>
  </div>
{% endif %}

{% if category_link %}
  </a>
{% else %}
  </div>
{% endif %}

<style>
  .collection-card {
    transition: transform 0.3s ease;
  }

  .collection-card:hover {
    transform: translateY(-2px);
  }

  .collection-card img {
    transition: transform 0.3s ease;
  }

  .collection-card:hover img {
    transform: scale(1.05);
  }
</style>
