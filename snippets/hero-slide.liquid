{% assign slide_image = slide.image_url | default: slide.image %}
{% assign is_video = false %}
{% assign has_mobile_video = false %}
{% assign has_desktop_video = false %}
{% assign fallback_button_text = section.settings.default_button_text | default: '' %}
{% assign fallback_button_link = section.settings.default_button_link | default: '' %}
{% assign button_text = slide.button_text | default: fallback_button_text %}
{% assign button_link_setting = slide.button_link | default: fallback_button_link %}
{% assign button_link = '' %}
{% if button_link_setting != blank %}
  {% assign button_link = button_link_setting | link_url %}
{% endif %}

{% comment %} Check for new mobile/desktop video fields {% endcomment %}
{% if slide.media_type == 'video' %}
  {% if slide.video_mobile %}
    {% assign has_mobile_video = true %}
    {% assign is_video = true %}
  {% endif %}
  {% if slide.video_desktop %}
    {% assign has_desktop_video = true %}
    {% assign is_video = true %}
  {% endif %}
  {% comment %} Fallback to legacy video field {% endcomment %}
  {% if slide.video and has_mobile_video == false and has_desktop_video == false %}
    {% assign is_video = true %}
  {% endif %}
{% endif %}

{% if slide_image or slide.title or slide.description or button_text or is_video %}
  <div
    class="absolute top-0 z-5 left-0 right-0 bottom-0 bg-gradient-to-t from-black/60 via-transparent to-black/60 pointer-events-none"
  ></div>
  <li
    class="glide__slide h-full w-full relative"
    {% if is_video %}
      data-video-slide="true"
    {% endif %}
  >
    {% if is_video %}
      <!-- Video Slide -->
      {% comment %} Mobile Video (hidden on desktop) {% endcomment %}
      {% if has_mobile_video %}
        <video
          class="w-full h-full object-cover lg:hidden"
          autoplay
          muted
          loop
          playsinline
          preload="auto"
          data-video-element
          onloadedmetadata="this.play().catch(e => console.log('Mobile video autoplay prevented:', e))"
        >
          {% if slide.video_mobile.sources %}
            {% for source in slide.video_mobile.sources %}
              <source src="{{ source.url }}" type="{{ source.mime_type }}">
            {% endfor %}
          {% else %}
            <source src="{{ slide.video_mobile | file_url }}" type="video/mp4">
          {% endif %}
          Your browser does not support the video tag.
        </video>
      {% endif %}

      {% comment %} Desktop Video (hidden on mobile) {% endcomment %}
      {% if has_desktop_video %}
        <video
          class="w-full h-full object-cover hidden lg:block"
          autoplay
          muted
          loop
          playsinline
          preload="auto"
          data-video-element
          onloadedmetadata="this.play().catch(e => console.log('Desktop video autoplay prevented:', e))"
        >
          {% if slide.video_desktop.sources %}
            {% for source in slide.video_desktop.sources %}
              <source src="{{ source.url }}" type="{{ source.mime_type }}">
            {% endfor %}
          {% else %}
            <source src="{{ slide.video_desktop | file_url }}" type="video/mp4">
          {% endif %}
          Your browser does not support the video tag.
        </video>
      {% endif %}

      {% comment %} Legacy single video (shown when mobile/desktop not specified) {% endcomment %}
      {% if slide.video and has_mobile_video == false and has_desktop_video == false %}
        <video
          class="w-full h-full object-cover"
          autoplay
          muted
          loop
          playsinline
          preload="auto"
          data-video-element
          onloadedmetadata="this.play().catch(e => console.log('Legacy video autoplay prevented:', e))"
        >
          {% if slide.video.sources %}
            {% for source in slide.video.sources %}
              <source src="{{ source.url }}" type="{{ source.mime_type }}">
            {% endfor %}
          {% else %}
            <source src="{{ slide.video | file_url }}" type="video/mp4">
          {% endif %}
          Your browser does not support the video tag.
        </video>
      {% endif %}
    {% elsif slide_image %}
      <!-- Image Slide -->
      {% if slide.image_url %}
        <img
          src="{{ slide.image_url }}"
          alt="{{ slide.title | escape }}"
          class="w-full h-full object-cover"
          width="1920"
          height="1080"
          loading="lazy"
        >
      {% elsif slide.image %}
        {{
          slide.image
          | image_url: width: 1920
          | image_tag: class: 'w-full h-full object-cover', alt: slide.title, loading: 'lazy', width: 1920, height: 1080
        }}
      {% endif %}
    {% endif %}

{% if slide.title or slide.description or button_text %}
      <div
        class="hero-slide-content absolute inset-x-0 bottom-8 px-4 lg:px-24 text-white flex flex-col gap-7 z-10 text-left"
      >
      <div class="hero-slide-text flex flex-col gap-3 max-w-full lg:max-w-4xl">

        {% if slide.title %}
          <h1 class="text-shadow">
            {{ slide.title }}
            </h1>
          {% endif %}

          {% if slide.description %}
            <p class="body text-white/90 text-shadow">
            {{ slide.description }}
            </p>
          {% endif %}
          </div>
        {% if button_text != blank and button_link != blank %}
          <a
            href="{{ button_link }}"
            class="
              font-semibold w-fit flex items-center justify-center
              {{ slide.button_style }}
            "
          >
            <button>
              <h6 class="capitalize">
                {{ button_text }}
              </h6>
            </button>
          </a>
        {% endif %}
      </div>
    {% endif %}
  </li>
{% endif %}
