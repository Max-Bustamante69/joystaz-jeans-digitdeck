{% comment %}
  Star Rating Snippet
  Usage: {% render 'star-rating', rating: rating_value, size: 'sm'|'md'|'lg'|'xl' %}

  Parameters:
  - rating: number from 1-5 (can be decimal like 4.1)
  - size: 'sm' (w-3 h-3), 'md' (w-4 h-4), 'lg' (w-5 h-5), 'xl' (w-6 h-6)
  - show_count: boolean to show review count (default: true)
  - review_count: number of reviews to display
  - color: custom color class (default: text-yellow-400)
  - show_rating_value: boolean to show the rating number (default: true)
  - show_review_count: boolean to show the review count in parentheses (default: true)
{% endcomment %}

{% assign rating = rating | default: 0 %}
{% assign size = size | default: 'md' %}
{% assign show_count = show_count | default: true %}
{% assign review_count = review_count | default: 0 %}
{% assign color = color | default: 'text-[#F3A000]' %}
{% assign show_rating_value = show_rating_value %}
{% assign show_review_count = show_review_count %}
{% assign show_review_text = show_review_text %}
{% assign single_star_mode = single_star_mode | default: false %}

{% comment %} Calculate star dimensions based on size parameter {% endcomment %}
{% case size %}
  {% when 'sm' %}
    {% assign star_size = 'w-3 h-3' %}
  {% when 'md' %}
    {% assign star_size = 'w-4 h-4' %}
  {% when 'lg' %}
    {% assign star_size = 'w-5 h-5' %}
  {% when 'xl' %}
    {% assign star_size = 'w-6 h-6' %}
  {% else %}
    {% assign star_size = 'w-3.5 h-3.5' %}
{% endcase %}

{% comment %} Calculate star fill percentages (only for desktop) {% endcomment %}
{% assign full_stars = rating | floor %}
{% assign partial_star_percentage = rating | modulo: 1 | times: 100 %}
{% assign empty_stars = 5 | minus: full_stars %}

{% if partial_star_percentage > 0 %}
  {% assign empty_stars = empty_stars | minus: 1 %}
{% endif %}

<div class="flex items-center {{ color }}">
  {% comment %} Single colored star (mobile by default, or forced with single_star_mode) {% endcomment %}
  <div class="{% if single_star_mode %}{% else %}lg:hidden{% endif %}">
    {% if rating > 0 %}
      <svg class="{{ star_size }}" fill="currentColor" viewBox="0 0 24 24">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>
    {% endif %}
  </div>

  {% comment %} Desktop: Full star rating calculation {% endcomment %}
  <div class="{% if single_star_mode %}hidden{% else %}hidden lg:flex{% endif %} items-center">
    {% comment %} Full stars {% endcomment %}
    {% for i in (1..full_stars) %}
      <svg class="{{ star_size }}" fill="currentColor" viewBox="0 0 24 24">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>
    {% endfor %}

    {% comment %} Partial star (if rating has decimal) {% endcomment %}
    {% if partial_star_percentage > 0 %}
      <svg class="{{ star_size }}" viewBox="0 0 24 24">
        <defs>
          <linearGradient id="partial-star-{{ rating | replace: '.', '-' }}-{{ forloop.index }}">
            <stop offset="{{ partial_star_percentage }}%" stop-color="currentColor"/>
            <stop offset="{{ partial_star_percentage }}%" stop-color="#e5e7eb"/>
          </linearGradient>
        </defs>
        <path fill="url(#partial-star-{{ rating | replace: '.', '-' }}-{{ forloop.index }})" d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>
    {% endif %}

    {% comment %} Empty stars {% endcomment %}
    {% for i in (1..empty_stars) %}
      <svg class="{{ star_size }}" fill="#e5e7eb" viewBox="0 0 24 24">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>
    {% endfor %}
  </div>
</div>

{% if show_count %}
  <div class="body-sm flex items-center gap-1">
    {% if show_rating_value %}
      <span class="body-sm">( {{ rating | default: 0 }} )</span>
    {% endif %}
    {% if show_review_count %}
      <span class="body-sm">
        {{- review_count | default: 0 }}
        {% if show_review_text %}
          <a
            href="#product-reviews"
            class="hover-line-inverse cursor-pointer hover:text-gray-600 transition-colors"
            onclick="event.preventDefault(); const target = document.getElementById('product-reviews'); if (target) { const targetPosition = target.offsetTop - 300; window.scrollTo({ top: targetPosition, behavior: 'smooth' }); }"
          >
            {{ 'Reseñas' | pluralize: review_count, 'Reseña' }}
          </a>
        {% endif %}
      </span>
    {% endif %}
  </div>
{% endif %}
