{% comment %}
  Size Selector Snippet

  Usage:
  {% render 'size-selector',
    product: product,
    selected_size_variable: 'selectedSize',
    click_function: 'selectSize',
    product_number: nil,
    show_main_label: false,
    show_size_guide: false
  %}

  Parameters:
  - product: Product object
  - selected_size_variable: Alpine.js variable name for selected size
  - click_function: Function name to call on size selection
  - product_number: For duo selections (1 or 2), nil for single
  - show_main_label: Show main "Elije una talla" label (for single mode)
  - show_size_guide: Show size guide button (for single mode)
{% endcomment %}

{% for product_option in product.options_with_values %}
  {% if product_option.name == 'Talla' %}
    <div class="space-y-2">
      {% if show_main_label %}
          <div class="flex items-center justify-between">
          <div class="flex items-center gap-2">
            
          <p class="body font-semibold">
            Elije una talla
            {% if product_number %}
              <p
                class="body font-semibold text-gray-400"
                x-show="{{ selected_size_variable | remove: "'" }}.size"
                x-text="{{ selected_size_variable | remove: "'" }}.size"
              ></p>
            {% else %}
              <p
                class="body font-semibold text-gray-400"
                x-show="{{ selected_size_variable }}"
                x-text="{{ selected_size_variable }}"
              ></p>
            {% endif %}
          </p>
          </div>
          {% if show_size_guide %}
            <button class="text-sm text-gray-600 underline hover:text-gray-900 transition-colors">
              Gu√≠a de tallas
            </button>
          {% endif %}
        </div>
      {% else %}
        <label class="text-sm font-medium text-gray-700">
          Talla:
          {% if product_number %}
            <span
              class="ml-2 font-normal text-gray-500"
              x-show="{{ selected_size_variable | remove: "'" }}.size"
              x-text="{{ selected_size_variable | remove: "'" }}.size"
            ></span>
          {% else %}
            <span
              class="ml-2 font-normal text-gray-500"
              x-show="{{ selected_size_variable }}"
              x-text="{{ selected_size_variable }}"
            ></span>
          {% endif %}
        </label>
      {% endif %}
      <div class="flex gap-2">
        {% for product_option_value in product_option.values %}
          {% comment %} Find the first variant that contains this size {% endcomment %}
          {% assign size_variant_id = null %}
          {% for variant in product.variants %}
            {% if variant.options contains product_option_value %}
              {% assign size_variant_id = variant.id %}
              {% break %}
            {% endif %}
          {% endfor %}

          <button
            {% if product_number %}
              @click="window.isDuoSizeAvailable && window.isDuoSizeAvailable({{ product_number }}, '{{ product_option_value }}') ? {{ click_function }}({{ product_number }}, '{{ product_option_value }}', {{ size_variant_id }}) : null"
              :class="
                [
                  {{ selected_size_variable | remove: "'" }}.size === '{{ product_option_value }}' ? 'bg-primary text-white border-gray-900' : 'border-gray-300 text-gray-900 hover:border-gray-400',
                  (window.isDuoSizeAvailable && window.isDuoSizeAvailable({{ product_number }}, '{{ product_option_value }}')) ? '' : 'opacity-40 cursor-not-allowed text-gray-800'
                ]
              "
              :disabled="!(window.isDuoSizeAvailable && window.isDuoSizeAvailable({{ product_number }}, '{{ product_option_value }}'))"
            {% else %}
              @click="isSizeAvailable('{{ product_option_value }}') ? {{ click_function }}('{{ product_option_value }}', findVariantIdForSize('{{ product_option_value }}')) : null"
              :class="
                [
                  {{ selected_size_variable }} === '{{ product_option_value }}' ? 'bg-primary text-white border-gray-900' : 'border-gray-300 text-gray-900 hover:border-gray-400',
                  isSizeAvailable('{{ product_option_value }}') ? '' : 'opacity-40 cursor-not-allowed text-gray-800'
                ]
              "
              :disabled="!isSizeAvailable('{{ product_option_value }}')"
            {% endif %}
            class="relative size-12 p-2 text-lg flex items-center justify-center font-medium border-2 rounded-full transition-all duration-200 overflow-hidden"
          >
            {{ product_option_value }}
            <!-- Diagonal line for unavailable sizes -->
            {% unless product_number %}
              <div
                x-show="!isSizeAvailable('{{ product_option_value }}')"
                class="absolute inset-0 pointer-events-none"
              >
                <svg class="w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="none">
                  <line x1="0" y1="0" x2="100" y2="100"
                        stroke="currentColor"
                        stroke-width="3"
                        class=""/>
                </svg>
              </div>
            {% else %}
              <div
                x-show="!(window.isDuoSizeAvailable && window.isDuoSizeAvailable({{ product_number }}, '{{ product_option_value }}'))"
                class="absolute inset-0 pointer-events-none"
              >
                <svg class="w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="none">
                  <line x1="0" y1="0" x2="100" y2="100"
                        stroke="currentColor"
                        stroke-width="3"
                        class=""/>
                </svg>
              </div>
            {% endunless %}
          </button>
        {% endfor %}
      </div>
    </div>
  {% endif %}
{% endfor %}
