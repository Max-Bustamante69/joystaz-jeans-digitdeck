{% comment %}
  Blog Carousel Section
  Features:
  - Blog articles from selected blog
  - Reusable carousel component
  - Customizable blog cards with image aspect ratio
  - Optional excerpt, date, and author display
  - Same styling and behavior as product carousel
{% endcomment %}

<section class="py-12 lg:py-10 overflow-x-hidden" id="blog-carousel-{{ section.id }}">
  <div class="w-full flex flex-col gap-8">
    {% if section.settings.title != blank %}
      <div class="flex justify-between items-end mx-4 lg:mx-12">
        <div class="flex flex-col gap-2">
          <h2>{{ section.settings.title }}</h2>
          {% if section.settings.rich_text != blank %}
            <div class="rich-text">{{ section.settings.rich_text }}</div>
          {% endif %}
        </div>
        <div class="flex items-center gap-8">
          {% if section.settings.show_view_all and section.settings.view_all_link != blank %}
            <a
              href="{{ section.settings.view_all_link }}"
              class="text-gray-600 hover:text-gray-900 transition-colors underline"
            >
              {{ section.settings.view_all_text | default: 'Ver todos' }}
            </a>
          {% endif %}
          {% comment %} Always show arrows for blog carousel {% endcomment %}
          {% render 'carousel-arrows' %}
        </div>
      </div>
    {% endif %}

    {% comment %} Get articles from selected blog or current blog context {% endcomment %}
    {% assign articles = '' %}
    {% if section.settings.blog != blank %}
      {% assign articles = section.settings.blog.articles %}
    {% elsif blog %}
      {% comment %} Use current blog context if no specific blog is selected {% endcomment %}
      {% assign articles = blog.articles %}
    {% endif %}

    {% comment %} Count available articles {% endcomment %}
    {% assign available_count = 0 %}
    {% for article in articles %}
      {% if article.published_at != blank %}
        {% assign available_count = available_count | plus: 1 %}
      {% endif %}
    {% endfor %}

    {% if available_count > 0 %}
      {% comment %} Build carousel content {% endcomment %}
      {% capture carousel_content %}
        {% assign articles_shown = 0 %}
        {% for article in articles %}
          {% if article.published_at != blank and articles_shown < section.settings.max_articles %}
            <div class="swiper-slide h-auto flex items-stretch">
              <div class="w-full flex flex-col max-w-full">
                {% render 'blog-card',
                  article: article,
                  image_aspect_ratio: section.settings.image_aspect_ratio,
                  show_excerpt: section.settings.show_excerpt,
                  show_date: section.settings.show_date,
                  show_author: section.settings.show_author,
                  excerpt_limit: section.settings.excerpt_limit
                %}
              </div>
            </div>
            {% assign articles_shown = articles_shown | plus: 1 %}
          {% endif %}
        {% endfor %}
      {% endcapture %}

      {% comment %} Render carousel using generic carousel snippet {% endcomment %}
      <div class="px-4 lg:px-12">
        {% render 'generic-carousel',
          carousel_id: section.id,
          carousel_class: 'blog-carousel',
          content: carousel_content,
          show_arrows: section.settings.show_arrows,
          slides_per_view_mobile: section.settings.slides_per_view_mobile,
          slides_per_view_desktop: section.settings.slides_per_view_desktop,
          space_between_mobile: section.settings.space_between_mobile,
          space_between_desktop: section.settings.space_between_desktop,
          centered_slides: section.settings.centered_slides,
          free_mode: section.settings.free_mode,
          total_items: available_count
        %}
      </div>
    {% else %}
      {% comment %} Show message when no articles are available {% endcomment %}
      <div class="text-center py-8">
        <p class="text-gray-600">
          {{ section.settings.no_articles_message | default: 'No hay artículos disponibles en este momento.' }}
        </p>
      </div>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "Blog Carousel",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Carousel Title",
      "default": "Artículos Similares"
    },
    {
      "type": "richtext",
      "id": "rich_text",
      "label": "Rich Text",
      "info": "Optional rich text content below the title"
    },
    {
      "type": "header",
      "content": "View All Link"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show View All Link",
      "default": true
    },
    {
      "type": "text",
      "id": "view_all_text",
      "label": "View All Text",
      "default": "Ver todos"
    },
    {
      "type": "url",
      "id": "view_all_link",
      "label": "View All Link"
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "Show Navigation Arrows",
      "default": true
    },
    {
      "type": "header",
      "content": "Blog Selection"
    },
    {
      "type": "blog",
      "id": "blog",
      "label": "Blog",
      "info": "Select specific blog to display articles from. Leave empty to use current blog context."
    },
    {
      "type": "range",
      "id": "max_articles",
      "label": "Maximum Articles",
      "min": 3,
      "max": 20,
      "step": 1,
      "default": 12
    },
    {
      "type": "header",
      "content": "Article Card Display"
    },
    {
      "type": "select",
      "id": "image_aspect_ratio",
      "label": "Image Aspect Ratio",
      "options": [
        {
          "value": "4/3",
          "label": "4:3 (Landscape)"
        },
        {
          "value": "3/4",
          "label": "3:4 (Portrait)"
        }
      ],
      "default": "4/3"
    },
    {
      "type": "checkbox",
      "id": "show_excerpt",
      "label": "Show Article Excerpt",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "label": "Show Published Date",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_author",
      "label": "Show Author",
      "default": false
    },
    {
      "type": "range",
      "id": "excerpt_limit",
      "label": "Excerpt Character Limit",
      "min": 80,
      "max": 200,
      "step": 10,
      "default": 120
    },
    {
      "type": "header",
      "content": "Messages"
    },
    {
      "type": "text",
      "id": "no_articles_message",
      "label": "No Articles Available Message",
      "default": "No hay artículos disponibles en este momento.",
      "info": "Message shown when no articles are available to display"
    },
    {
      "type": "header",
      "content": "Carousel Settings"
    },
    {
      "type": "range",
      "id": "slides_per_view_mobile",
      "label": "Mobile Slides Per View",
      "min": 1,
      "max": 3,
      "step": 0.1,
      "default": 1.2
    },
    {
      "type": "range",
      "id": "slides_per_view_desktop",
      "label": "Desktop Slides Per View",
      "min": 2,
      "max": 6,
      "step": 1,
      "default": 3
    },
    {
      "type": "range",
      "id": "space_between_mobile",
      "label": "Mobile Space Between Slides",
      "min": 0,
      "max": 20,
      "step": 2,
      "default": 2
    },
    {
      "type": "range",
      "id": "space_between_desktop",
      "label": "Desktop Space Between Slides",
      "min": 0,
      "max": 30,
      "step": 2,
      "default": 16
    },
    {
      "type": "checkbox",
      "id": "centered_slides",
      "label": "Center Slides (Mobile)",
      "default": true,
      "info": "Center slides on mobile devices"
    },
    {
      "type": "checkbox",
      "id": "free_mode",
      "label": "Enable Free Mode",
      "default": true,
      "info": "Allow free scrolling between slides"
    }
  ],
  "presets": [
    {
      "name": "Blog Carousel"
    }
  ]
}
{% endschema %}
