{% comment %}
  Collection Card Snippet
  Usage: {% render 'collection-card', collection: collection_object, custom_image: image, custom_video: video, image_source: 'collection_image', text_position: 'bottom-left', aspect_ratio: 'portrait' %}

  Parameters:
  - collection: Collection object (required)
  - custom_image: Custom image (optional)
  - custom_video: Custom video (optional)
  - image_source: 'collection_image', 'collection_card_image', or 'custom_image'
  - text_position: 'bottom-left', 'bottom-center', 'bottom-right', 'center'
  - aspect_ratio: 'square', 'portrait', 'landscape', 'wide', 'ultra-wide', 'tall'
{% endcomment %}

{% comment %} Extract collection data {% endcomment %}
{% assign category_title = collection.title %}
{% assign category_link = collection.url %}

{% comment %} Determine which image/video to use based on priority and settings {% endcomment %}
{% assign category_image = null %}
{% assign category_video = null %}

{% comment %} Priority 1: Custom video (if provided) {% endcomment %}
{% if custom_video %}
  {% assign category_video = custom_video %}
{% else %}
  {% comment %} Priority 2: Custom image (if provided and image_source is 'custom_image') {% endcomment %}
  {% if custom_image and image_source == 'custom_image' %}
    {% assign category_image = custom_image %}
  {% else %}
    {% comment %} Priority 3: Collection card image (if image_source is 'collection_card_image') {% endcomment %}
    {% if image_source == 'collection_card_image' and collection.metafields.custom.card_image.value %}
      {% assign category_image = collection.metafields.custom.card_image.value %}
    {% else %}
      {% comment %} Priority 4: Collection default image {% endcomment %}
      {% if collection.image %}
        {% assign category_image = collection.image %}
      {% endif %}
    {% endif %}
  {% endif %}
{% endif %}

{% assign text_position_classes = 'absolute text-white z-10' %}

{% case text_position %}
  {% when 'bottom-left' %}
    {% assign text_position_classes = text_position_classes | append: ' bottom-8 left-12' %}
  {% when 'bottom-center' %}
    {% assign text_position_classes = text_position_classes
      | append: ' bottom-4 left-1/2 transform -translate-x-1/2 text-center'
    %}
  {% when 'bottom-right' %}
    {% assign text_position_classes = text_position_classes | append: ' bottom-4 right-4 text-right' %}
  {% when 'center' %}
    {% assign text_position_classes = text_position_classes
      | append: ' top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center'
    %}
  {% else %}
    {% assign text_position_classes = text_position_classes | append: ' bottom-4 left-4' %}
{% endcase %}

{% comment %} Set aspect ratio classes {% endcomment %}
{% assign aspect_ratio_class = 'portrait' %}
{% case aspect_ratio %}
  {% when 'square' %}
    {% assign aspect_ratio_class = 'aspect-square' %}
  {% when 'portrait' %}
    {% assign aspect_ratio_class = 'aspect-[3/4]' %}
  {% when 'landscape' %}
    {% assign aspect_ratio_class = 'aspect-[4/3]' %}
  {% when 'wide' %}
    {% assign aspect_ratio_class = 'aspect-[16/9]' %}
  {% when 'ultra-wide' %}
    {% assign aspect_ratio_class = 'aspect-[21/9]' %}
  {% when 'tall' %}
    {% assign aspect_ratio_class = 'aspect-[2/3]' %}
  {% else %}
    {% assign aspect_ratio_class = 'aspect-square' %}
{% endcase %}

{% if category_link %}
  <a
    href="{{ category_link }}"
    class="collection-card block relative {{ aspect_ratio_class }} overflow-hidden group w-[110%] md:min-w-[220px]"
  >
{% else %}
  <div class="collection-card relative overflow-hidden {{ aspect_ratio_class }} w-[110%] md:min-w-[220px]">
{% endif %}

{% if category_video %}
  <!-- Video Display -->
  <video
    class="w-full h-full object-cover transition-transform duration-300"
    muted
    loop
    playsinline
    preload="metadata"
    autoplay
  >
    {% if category_video.sources %}
      {% for source in category_video.sources %}
        <source src="{{ source.url | asset_url }}" type="{{ source.mime_type }}">
      {% endfor %}
    {% else %}
      <source src="{{ category_video | asset_url }}" type="video/mp4">
    {% endif %}
    Your browser does not support the video tag.
  </video>
{% elsif category_image %}
  <!-- Image Display -->
  {{
    category_image
    | image_url: width: 400
    | image_tag:
      class: 'w-full h-full object-cover transition-transform duration-300',
      alt: category_title,
      loading: 'lazy'
  }}
{% else %}
  <!-- Fallback -->
  <div class="w-full h-full bg-gray-200 flex items-center justify-center">
    <span class="text-gray-400 text-sm">No media</span>
  </div>
{% endif %}

<!-- Gradient overlay for better text readability -->
<div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent to-60%"></div>

{% if category_title %}
  <div class="{{ text_position_classes }}">
    <h3>
      {{ category_title }}
    </h3>
  </div>
{% endif %}

{% if category_link %}
  </a>
{% else %}
  </div>
{% endif %}

<style>
  .collection-card {
    transition: transform 0.3s ease;
  }

  .collection-card:hover {
    transform: translateY(-2px);
  }

  .collection-card img {
    transition: transform 0.3s ease;
  }

  .collection-card:hover img,
  .collection-card:hover video {
    transform: scale(1.05);
  }

  .collection-card video {
    transition: transform 0.3s ease;
  }
</style>
