{% comment %}
  Search Section with Alpine.js
  Features:
  - Enhanced search form
  - Better search results display
  - Loading states
  - Improved user experience
{% endcomment %}

<div
  class="search-section py-16 px-4 md:px-8"
  x-data="
    {
      searchQuery: '{{ search.terms | escape }}',
      isSearching: false,
      showFilters: false
    }
  "
>
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-8">{{ 'search.title' | t }}</h1>

    <!-- Search Form -->
    <form action="{{ routes.search_url }}" method="get" role="search" class="mb-12">
      <div class="flex gap-4 max-w-2xl">
        <div class="flex-1 relative">
          <input
            type="search"
            name="q"
            x-model="searchQuery"
            placeholder="{{ 'search.placeholder' | t }}"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
            @input="isSearching = true"
            @keyup.debounce.500ms="isSearching = false"
          >
          <div x-show="isSearching" class="absolute right-3 top-1/2 transform -translate-y-1/2">
            <svg
              class="animate-spin h-5 w-5 text-gray-400"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
            >
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          </div>
        </div>
        <button
          type="submit"
          class="px-6 py-3 bg-primary text-white rounded-lg font-semibold hover:bg-primary/90 transition-colors"
        >
          {{ 'search.submit' | t }}
        </button>
      </div>
    </form>

    {% if search.performed %}
      <!-- Search Results Header -->
      <div class="mb-8">
        {% if search.results_count == 0 %}
          <div class="text-center py-16">
            <svg class="w-24 h-24 mx-auto text-gray-400 mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <h2 class="text-2xl font-semibold mb-4">No results found</h2>
            <p class="text-gray-600 mb-8">{{ 'search.no_results_html' | t: terms: search.terms }}</p>
            <a
              href="{{ routes.all_products_collection_url }}"
              class="bg-primary text-white py-3 px-8 rounded-lg font-semibold hover:bg-primary/90 transition-colors"
            >
              Browse All Products
            </a>
          </div>
        {% else %}
          <div class="flex justify-between items-center mb-6">
            <p class="text-lg text-gray-600">
              {{ 'search.results_for_html' | t: terms: search.terms, count: search.results_count }}
            </p>
            <button
              @click="showFilters = !showFilters"
              class="flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
            >
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
              </svg>
              Filters
            </button>
          </div>

          <!-- Search Results -->
          <div class="search-results">
            {% paginate search.results by 20 %}
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                {% for result in search.results %}
                  <div class="search-result bg-white border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition-shadow">
                    {% assign featured_image = result.featured_image | default: result.image %}
                    {% if featured_image %}
                      <div class="aspect-square overflow-hidden">
                        {% render 'image',
                          class: 'w-full h-full object-cover',
                          image: featured_image,
                          url: result.url,
                          width: 400
                        %}
                      </div>
                    {% endif %}
                    <div class="p-4">
                      <h3 class="font-semibold text-lg mb-2">
                        <a href="{{ result.url }}" class="hover:text-primary transition-colors">
                          {{ result.title }}
                        </a>
                      </h3>
                      {% if result.price %}
                        <p class="text-lg font-bold text-primary">{{ result.price | money_with_currency }}</p>
                      {% endif %}
                      {% if result.excerpt %}
                        <p class="text-gray-600 text-sm mt-2 line-clamp-2">{{ result.excerpt }}</p>
                      {% endif %}
                      <div class="mt-3">
                        <span class="inline-block px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">
                          {{ result.object_type | capitalize }}
                        </span>
                      </div>
                    </div>
                  </div>
                {% endfor %}
              </div>

              <!-- Pagination -->
              {% if paginate.pages > 1 %}
                <div class="mt-12 flex justify-center">
                  <nav class="flex items-center gap-2">
                    {% if paginate.previous %}
                      <a
                        href="{{ paginate.previous.url }}"
                        class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
                      >
                        Previous
                      </a>
                    {% endif %}

                    {% for part in paginate.parts %}
                      {% if part.is_link %}
                        <a
                          href="{{ part.url }}"
                          class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
                        >
                          {{ part.title }}
                        </a>
                      {% else %}
                        <span class="px-4 py-2 bg-primary text-white rounded-lg">
                          {{ part.title }}
                        </span>
                      {% endif %}
                    {% endfor %}

                    {% if paginate.next %}
                      <a
                        href="{{ paginate.next.url }}"
                        class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
                      >
                        Next
                      </a>
                    {% endif %}
                  </nav>
                </div>
              {% endif %}
            {% endpaginate %}
          </div>
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>

<style>
  .search-section {
    min-height: 60vh;
  }

  .search-result {
    transition: all 0.3s ease;
  }

  .search-result:hover {
    transform: translateY(-2px);
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>

{% schema %}
{
  "name": "t:general.search",
  "settings": []
}
{% endschema %}
