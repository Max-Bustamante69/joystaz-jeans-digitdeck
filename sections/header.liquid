<header
  class="flex flex-col bg-transparent absolute top-0 left-0 right-0 z-50 overflow-hidden"
  x-data="
    {
      mobileMenuOpen: false,
      cartDrawerOpen: false,
      openCartDrawer() {
        this.cartDrawerOpen = true;
      }
    }
  "
>
  <div class="w-screen overflow-hidden bg-primary py-2 whitespace-nowrap">
    <div class="ticker-wrap inline-block">
      <span class="ticker-item text-white text-md font-medium tracking-wide"
        >Class Is in Session &bull; Class Is in Session &bull; Class Is in Session &bull; Class Is in Session &bull;
        Class Is in Session &bull; Class Is in Session &bull; Class Is in Session &bull; Class Is in Session &bull;
        Class Is in Session &bull; Class Is in Session &bull;</span
      >
      <!-- Repeat the content to ensure smooth looping -->
      <span class="ticker-item text-white text-md font-medium tracking-wide"
        >Class Is in Session &bull; Class Is in Session &bull; Class Is in Session &bull; Class Is in Session &bull;
        Class Is in Session &bull; Class Is in Session &bull; Class Is in Session &bull; Class Is in Session &bull;
        Class Is in Session &bull; Class Is in Session &bull;</span
      >
    </div>
  </div>

  <nav class="grid grid-cols-3 py-8 px-6 md:px-24 bg-transparent text-white w-full bg-gradient-to-b from-black/60 to-transparent">
    <!-- Desktop Menu -->
    <div class="header__menu hidden xl:flex items-center justify-start gap-6">
      {% for link in section.settings.menu.links %}
        <p class="font-semibold">
          {{ link.title | link_to: link.url }}
        </p>
      {% endfor %}
    </div>

    <!-- Mobile Menu Button -->
    <div class="flex gap-6 items-center xl:hidden">
      <button
        @click="mobileMenuOpen = !mobileMenuOpen"
        class="text-white hover:text-gray-300 transition-colors"
        aria-label="Toggle mobile menu"
      >
        {% render 'menu-icon' %}
      </button>
      {% render 'search-icon' %}
    </div>

    <!-- Logo -->
    <h2 class="header__title flex items-center justify-center">
      <a href="{{ routes.root_url }}">
        <img src="../assets/logo.png" alt="Logo" class="invert-100" width="120" height="40">
      </a>
    </h2>

    <!-- Desktop Icons -->
    <div class="flex items-center justify-end gap-4">
      {% render 'search-icon', class: 'hidden xl:block' %}
      {% render 'heart-icon', class: 'hidden xl:block' %}
      {% render 'user-icon' %}
      {% render 'cart-trigger' %}
    </div>
  </nav>

  <!-- Mobile Menu Overlay -->
  <div
    x-show="mobileMenuOpen"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    class="fixed inset-0 bg-black bg-opacity-50 z-40 xl:hidden"
    @click="mobileMenuOpen = false"
  ></div>

  <!-- Mobile Menu Panel -->
  <div
    x-show="mobileMenuOpen"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="transform translate-x-full"
    x-transition:enter-end="transform translate-x-0"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="transform translate-x-0"
    x-transition:leave-end="transform translate-x-full"
    class="fixed top-0 right-0 h-full w-80 bg-white text-black z-50 xl:hidden"
  >
    <div class="p-6">
      <div class="flex justify-between items-center mb-8">
        <h3 class="text-lg font-semibold">Menu</h3>
        <button
          @click="mobileMenuOpen = false"
          class="text-gray-500 hover:text-gray-700"
          aria-label="Close mobile menu"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <nav class="space-y-4">
        {% for link in section.settings.menu.links %}
          <a
            href="{{ link.url }}"
            class="block py-2 text-gray-700 hover:text-gray-900 transition-colors"
            @click="mobileMenuOpen = false"
          >
            {{ link.title }}
          </a>
        {% endfor %}
      </nav>

      <div class="mt-8 pt-8 border-t border-gray-200">
        <div class="flex gap-4">
          {% render 'search-icon' %}
          {% render 'heart-icon' %}
          {% render 'user-icon' %}
          {% render 'cart-trigger' %}
        </div>
      </div>
    </div>
  </div>

  <!-- Cart Drawer -->
  <div
    x-show="cartDrawerOpen"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    class="fixed inset-0 z-50 overflow-hidden"
    @click.self="cartDrawerOpen = false"
    @keydown.escape.window="cartDrawerOpen = false"
  >
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black bg-opacity-50"></div>

    <!-- Drawer -->
    <div
      x-show="cartDrawerOpen"
      x-transition:enter="transform transition ease-in-out duration-300"
      x-transition:enter-start="translate-x-full"
      x-transition:enter-end="translate-x-0"
      x-transition:leave="transform transition ease-in-out duration-300"
      x-transition:leave-start="translate-x-0"
      x-transition:leave-end="translate-x-full"
      class="absolute right-0 top-0 h-full w-full max-w-md bg-white shadow-xl flex flex-col"
    >
      <!-- Header -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200">
        <h2 class="text-xl font-bold text-gray-900">Your Cart</h2>
        <button
          @click="cartDrawerOpen = false"
          class="text-gray-400 hover:text-gray-600 transition-colors"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Progress Bar for Free Shipping -->
      <div class="p-4 bg-gray-50 border-b border-gray-200">
        <div class="flex items-center justify-between mb-2">
          <div class="flex items-center space-x-2">
            <div class="flex items-center space-x-1">
              <svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
              <span class="text-sm font-medium text-green-600">Envío gratis</span>
            </div>
          </div>
        </div>

        <!-- Progress Bar -->
        <div class="w-full bg-gray-200 rounded-full h-2 mb-2">
          <div
            class="bg-green-600 h-2 rounded-full transition-all duration-300"
            :style="`width: ${Math.min(({{ cart.total_price }} / 150000) * 100, 100)}%`"
          ></div>
        </div>

        <p class="text-sm text-gray-600">
          Estas a <span class="font-semibold">${{ 150000 | minus: cart.total_price | money_without_currency }}</span> de
          adquirir envío gratis
        </p>
      </div>

      <!-- Cart Items -->
      <div class="flex-1 overflow-y-auto p-4 space-y-4">
        {% if cart.item_count > 0 %}
          {% for item in cart.items %}
            <div class="cart-product-card flex gap-4 p-4 border border-gray-200 rounded-lg bg-white">
              <!-- Product Image -->
              <div class="flex-shrink-0">
                <img
                  src="{{ item.image | image_url: width: 80 }}"
                  alt="{{ item.product.title }}"
                  class="w-20 h-20 object-cover rounded-md"
                  width="80"
                  height="80"
                  loading="lazy"
                >
              </div>

              <!-- Product Details -->
              <div class="flex-1 min-w-0">
                <!-- Product Title and Tag -->
                <div class="flex items-start justify-between mb-1">
                  <h3 class="font-semibold text-gray-900 text-sm leading-tight truncate">{{ item.product.title }}</h3>
                  {% assign has_nuevo_tag = false %}
                  {% for tag in item.product.tags %}
                    {% assign tag_lower = tag | downcase %}
                    {% if tag_lower contains 'nuevo' %}
                      {% assign has_nuevo_tag = true %}
                      {% break %}
                    {% endif %}
                  {% endfor %}
                  {% if has_nuevo_tag %}
                    <span class="bg-amber-100 text-amber-800 text-xs px-2 py-1 rounded font-bold ml-2 flex-shrink-0">
                      NUEVO
                    </span>
                  {% endif %}
                </div>

                <!-- Variant Details -->
                <p class="text-gray-600 text-sm mb-2">{{ item.variant.title }}</p>

                <!-- Rating -->
                <div class="flex items-center gap-1 mb-2">
                  <div class="flex text-yellow-400">
                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                    <svg class="w-3 h-3" fill="#e5e7eb" viewBox="0 0 24 24">
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                  </div>
                  <span class="text-xs text-gray-500">(0)</span>
                </div>

                <!-- Stock Availability -->
                <p class="text-red-600 text-xs font-medium mb-2">Ultimas unidades disponibles</p>

                <!-- Price -->
                <div class="flex items-center justify-between">
                  <div class="flex items-center space-x-2">
                    <span class="font-bold text-gray-900 text-sm"
                      >${{ item.final_line_price | money_without_currency -}}
                    </span>
                    {% if item.original_line_price and item.original_line_price > item.final_line_price %}
                      <span class="text-xs text-gray-500 line-through"
                        >${{ item.original_line_price | money_without_currency -}}
                      </span>
                    {% endif %}
                  </div>

                  <!-- Quantity Controls -->
                  <div class="flex items-center gap-2">
                    <button
                      onclick="updateCartQuantity('{{ item.key }}', {{ item.quantity | minus: 1 }})"
                      class="w-6 h-6 flex items-center justify-center border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                      {% if item.quantity <= 1 %}
                        disabled
                      {% endif %}
                    >
                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                      </svg>
                    </button>

                    <span class="text-sm font-medium w-8 text-center">{{ item.quantity }}</span>

                    <button
                      onclick="updateCartQuantity('{{ item.key }}', {{ item.quantity | plus: 1 }})"
                      class="w-6 h-6 flex items-center justify-center border border-gray-300 rounded hover:bg-gray-50 transition-colors"
                    >
                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                      </svg>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Wishlist Button -->
              <button
                class="flex-shrink-0 text-gray-400 hover:text-red-500 transition-colors"
                onclick="toggleWishlist({{ item.product_id }})"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                </svg>
              </button>
            </div>
          {% endfor %}
        {% else %}
          <!-- Empty Cart -->
          <div class="text-center py-8">
            <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
            </svg>
            <h3 class="text-lg font-medium text-gray-900 mb-2">Your cart is empty</h3>
            <p class="text-gray-500">Add some products to get started</p>
          </div>
        {% endif %}
      </div>

      <!-- Footer -->
      <div class="border-t border-gray-200 p-4 space-y-4">
        <!-- Subtotal -->
        <div class="flex justify-between items-center">
          <span class="text-lg font-semibold">Subtotal:</span>
          <div class="text-right">
            {% assign cart_savings = cart.total_discount %}
            {% if cart_savings > 0 %}
              <div class="flex items-center space-x-2">
                <span class="bg-green-100 text-green-800 text-sm px-2 py-1 rounded font-medium">
                  AHORRA ${{ cart_savings | money_without_currency }}
                </span>
              </div>
            {% endif %}
            <div class="flex items-center space-x-2">
              {% if cart_savings > 0 %}
                <span class="text-gray-500 line-through text-sm"
                  >${{ cart.original_total_price | money_without_currency -}}
                </span>
              {% endif %}
              <span class="text-xl font-bold">${{ cart.total_price | money_without_currency }}</span>
            </div>
          </div>
        </div>

        <!-- Payment Button -->
        <button
          onclick="window.location.href='/checkout'"
          {% if cart.item_count == 0 %}
            disabled
          {% endif %}
          class="w-full bg-gray-900 text-white py-4 px-6 rounded-lg font-semibold hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Paga de forma segura
        </button>

        <!-- Payment Methods -->
        <div class="flex items-center justify-center space-x-4 pt-2">
          <svg class="w-8 h-8 text-gray-400" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
          <svg class="w-8 h-8 text-gray-400" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
          <svg class="w-8 h-8 text-gray-400" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
          <svg class="w-8 h-8 text-gray-400" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
        </div>
      </div>
    </div>
  </div>
</header>

{% stylesheet %}
  /* Ticker animation */
  .ticker-wrap {
    animation: ticker linear infinite;
    animation-duration: 40s;
    transform: translateX(0%);
  }

  @keyframes ticker {
    0% {
      transform: translateX(0%);
    }
    100% {
      transform: translateX(-50%);
    }
  }

  /* Mobile responsive ticker */
  @media (max-width: 768px) {
    .ticker-wrap {
      animation-duration: 25s;
    }
  }
{% endstylesheet %}

<script>
  // Cart functionality
  async function updateCartQuantity(itemKey, newQuantity) {
    if (newQuantity < 1) {
      await removeCartItem(itemKey);
      return;
    }

    try {
      const response = await fetch('/cart/change.js', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          id: itemKey,
          quantity: newQuantity,
        }),
      });

      if (response.ok) {
        // Reload the page to update cart drawer
        window.location.reload();
      }
    } catch (error) {
      console.error('Error updating quantity:', error);
    }
  }

  async function removeCartItem(itemKey) {
    try {
      const response = await fetch('/cart/change.js', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          id: itemKey,
          quantity: 0,
        }),
      });

      if (response.ok) {
        // Reload the page to update cart drawer
        window.location.reload();
      }
    } catch (error) {
      console.error('Error removing item:', error);
    }
  }

  function toggleWishlist(productId) {
    // Implement wishlist functionality here
    console.log('Toggle wishlist for product:', productId);
  }
</script>

{% schema %}
{
  "name": "t:general.header",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "label": "t:labels.menu"
    }
  ]
}
{% endschema %}
