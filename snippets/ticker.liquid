{% comment %}
  Parameters:
  - items: array of ticker items (section.blocks)
  - duration: animation duration for desktop (optional)
  - mobile_duration: animation duration for mobile (optional)
{% endcomment %}

{% assign ticker_items = items | default: blank %}
{% assign has_items = false %}
{% assign item_count = 0 %}

{% comment %} Check if we have items to display and count them {% endcomment %}
{% if ticker_items.size > 0 %}
  {% assign has_items = true %}
  {% for item in ticker_items %}
    {% if item.type == 'ticker_item' and item.settings.text != blank %}
      {% assign item_count = item_count | plus: 1 %}
    {% endif %}
  {% endfor %}
{% endif %}

{% comment %} Fallback items if no items are provided {% endcomment %}
{% unless has_items %}
  {% assign fallback_items = 'Class Is in Session,New Arrivals,Free Shipping' | split: ',' %}
  {% assign item_count = fallback_items.size %}
{% endunless %}

{% comment %} Calculate how many duplicates we need to fill screen width {% endcomment %}
{% comment %} We'll use CSS calc to determine this dynamically {% endcomment %}

<div class="ticker-container flex items-center w-screen bg-primary h-8 overflow-hidden">
  <div class="ticker-wrap flex items-center" style="width: max-content;">
    {% comment %} Create enough duplicates to fill screen + buffer {% endcomment %}
    {% for i in (1..12) %}
      {% comment %} First set of items {% endcomment %}
      {% if has_items %}
        {% for item in ticker_items %}
          {% if item.type == 'ticker_item' and item.settings.text != blank %}
            <span class="ticker-item text-white body-sm flex items-center whitespace-nowrap">
              {{ item.settings.text }}
            </span>
            {% unless forloop.last %}
              <span class="ticker-bullet text-white body-sm mx-3">&bull;</span>
            {% endunless %}
          {% endif %}
        {% endfor %}
      {% else %}
        {% for fallback_item in fallback_items %}
          <span class="ticker-item text-white body-sm flex items-center whitespace-nowrap">
            {{ fallback_item }}
          </span>
          {% unless forloop.last %}
            <span class="ticker-bullet text-white body-sm mx-3">&bull;</span>
          {% endunless %}
        {% endfor %}
      {% endif %}

      {% comment %} Add bullet between sets (except for the last set) {% endcomment %}
      {% unless forloop.last %}
        <span class="ticker-bullet text-white body-sm mx-3">&bull;</span>
      {% endunless %}
    {% endfor %}
  </div>
</div>
