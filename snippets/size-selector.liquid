{% comment %}
  Size Selector Snippet

  Usage:
  {% render 'size-selector',
    product: product,
    selected_size_variable: 'selectedSize',
    click_function: 'selectSize',
    product_number: nil,
    show_main_label: false,
    show_size_guide: false
  %}

  Parameters:
  - product: Product object
  - selected_size_variable: Alpine.js variable name for selected size
  - click_function: Function name to call on size selection
  - product_number: For duo selections (1 or 2), nil for single
  - show_main_label: Show main "Elije una talla" label (for single mode)
  - show_size_guide: Show size guide button (for single mode)
{% endcomment %}

{% for product_option in product.options_with_values %}
  {% if product_option.name == 'Talla' %}
    <div class="flex flex-col gap-2">
      {% if show_main_label %}
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-2">
            <p class="body font-semibold">
              Elije una talla
              {% if product_number %}
                <p
                  class="body font-semibold text-black/50"
                  x-show="{{ selected_size_variable | remove: "'" }}.size"
                  x-text="{{ selected_size_variable | remove: "'" }}.size"
                ></p>
              {% else %}
                <p
                  class="body font-semibold text-black/50"
                  x-show="{{ selected_size_variable }}"
                  x-text="{{ selected_size_variable }}"
                ></p>
              {% endif %}
            </p>
          </div>
          {% if show_size_guide %}
            <div class="flex items-center gap-1">
              {% render 'size-chart', class: 'w-4 h-4' %}
              <button class="text-sm text-black/50 underline hover:text-gray-900 transition-colors ">
                Gu√≠a de tallas
              </button>
            </div>
          {% endif %}
        </div>
      {% else %}
        <label class="text-sm font-medium text-gray-700">
          Talla:
          {% if product_number %}
            <span
              class="ml-2 font-normal text-gray-500"
              x-show="{{ selected_size_variable | remove: "'" }}.size"
              x-text="{{ selected_size_variable | remove: "'" }}.size"
            ></span>
          {% else %}
            <span
              class="ml-2 font-normal text-gray-500"
              x-show="{{ selected_size_variable }}"
              x-text="{{ selected_size_variable }}"
            ></span>
          {% endif %}
        </label>
      {% endif %}
      <div class="flex gap-2">
        {% for product_option_value in product_option.values %}
          {% comment %} Find the first variant that contains this size {% endcomment %}
          {% assign size_variant_id = null %}
          {% for variant in product.variants %}
            {% if variant.options contains product_option_value %}
              {% assign size_variant_id = variant.id %}
              {% break %}
            {% endif %}
          {% endfor %}

          <button
            {% if product_number %}
              @click="{{ click_function }}({{ product_number }}, '{{ product_option_value }}', {{ size_variant_id }})"
              :class="
                [
                  {{ selected_size_variable | remove: "'" }}.size === '{{ product_option_value }}' ? 'bg-primary text-white border-gray-900' : 'border-gray-300 text-gray-900',
                  !isSizeAvailable('{{ product_option_value }}') ? 'opacity-40 cursor-not-allowed' : 'hover:border-gray-400'
                ]
              "
              :disabled="!isSizeAvailable('{{ product_option_value }}')"
            {% else %}
              @click="{{ click_function }}('{{ product_option_value }}', findVariantIdForSize('{{ product_option_value }}'))"
              :class="
                [
                  {{ selected_size_variable }} === '{{ product_option_value }}' ? 'bg-primary text-white border-gray-900' : 'border-black/10 text-black',
                  !isSizeAvailable('{{ product_option_value }}') ? 'opacity-40 cursor-not-allowed' : 'hover:border-primary'
                ]
              "
              :disabled="!isSizeAvailable('{{ product_option_value }}')"
            {% endif %}
            class="relative size-10 p-3 body-sm flex items-center justify-center font-medium border rounded-full transition-all duration-300 overflow-hidden"
          >
            <!-- Bell icon for unavailable sizes - positioned to the left -->
            <div
              x-show="!isSizeAvailable('{{ product_option_value }}')"
              class="flex items-center gap-1"
            >
              {% render 'bell-icon', class: 'w-3 h-3 text-gray-400 flex-shrink-0' %}
              <span>{{ product_option_value }}</span>
            </div>

            <!-- Normal size display for available sizes -->
            <span x-show="isSizeAvailable('{{ product_option_value }}')">{{ product_option_value }}</span>

            <!-- Diagonal line overlay for unavailable sizes -->
            <div
              x-show="!isSizeAvailable('{{ product_option_value }}')"
              class="absolute inset-0 pointer-events-none flex items-center justify-center"
            >
              <svg class="w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="none">
                <line x1="0" y1="0" x2="100" y2="100"
                      stroke="currentColor"
                      stroke-width="2"
                      class="text-gray-400"/>
              </svg>
            </div>
          </button>
        {% endfor %}
      </div>
    </div>
  {% endif %}
{% endfor %}
